<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ライセンスキー生成</title>
    <style>
        /* 省略 */
    </style>

    <script>
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16).toUpperCase();
            });
        }

        function generateLicenseKey() {
            let existingKey = localStorage.getItem("licenseKey");
            if (existingKey) return;

            let newKey = generateUUID();
            localStorage.setItem("licenseKey", newKey);
            document.getElementById("licenseKey").innerText = `あなたのライセンスキー:\n${newKey}`;
            document.getElementById("generateBtn").innerText = "コピー";
            document.getElementById("generateBtn").onclick = () => copyToClipboard(newKey);
            document.getElementById("generateBtn").disabled = false;

            // Googleスプレッドシートにライセンスキーを送信
            saveLicenseKeyToGoogleSheet(newKey);
        }

        function copyToClipboard(key) {
            navigator.clipboard.writeText(key).then(() => {
                alert("ライセンスキーがコピーされました！");
            }, (err) => {
                alert("コピーに失敗しました。");
            });
        }

        function saveLicenseKeyToGoogleSheet(licenseKey) {
            const scriptURL = "https://script.google.com/macros/s/AKfycbwuiR1uYyn45LzNjAyPad8cURhcmJz-Iub88kQkdyRur8f96X19T4TF-WUPYDIQqnpkgQ/exec";  // Google Apps ScriptのURLに置き換えてください

            const params = new URLSearchParams();
            params.append('licenseKey', licenseKey);

            fetch(scriptURL, {
                method: 'POST',
                body: params
            }).then(response => response.text())
              .then(result => console.log('Success:', result))
              .catch(error => console.error('Error:', error));
        }

        window.onload = () => {
            let existingKey = localStorage.getItem("licenseKey");
            if (existingKey) {
                document.getElementById("licenseKey").innerText = `あなたのライセンスキー:\n${existingKey}`;
                document.getElementById("generateBtn").innerText = "コピー";
                document.getElementById("generateBtn").onclick = () => copyToClipboard(existingKey);
                document.getElementById("generateBtn").disabled = false;
            }
        };
    </script>
</head>
<body>
    <!-- 左上のアイコン -->
    <div class="social-links">
        <a href="https://discord.gg/y92a2EgJYt" target="_blank" title="Discord"><i class="fab fa-discord"></i></a>
        <a href="https://www.youtube.com/@TaikoNijiiroDon/" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
    </div>

    <div class="container">
        <h1>ライセンスキー生成</h1>
        <p class="description">TaikoNijiiroDonを使用するためのライセンスキーを生成します。</p>
        <p id="licenseKey">まだライセンスキーは生成されていません。</p>
        <button id="generateBtn" onclick="generateLicenseKey()">ライセンスキーを生成</button>

        <div class="note">
            このライセンスキーは<strong>絶対に他人に教えないでください</strong>。<br>
            一度でも他人に使われると再発行ができず、今後シミュレーターを利用できなくなります。
        </div>
    </div>
</body>
</html>
